<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Ranjib Dey"><link rel="shortcut icon" type=image/x-icon href=https://reef-pi.github.io/img/favicon.ico><title>Development environment | reef-pi - An opensource reef tank controller based on Raspberry Pi</title><meta name=description content="reef-pi is written in go and react. This guide will walk through the steps involved in setting up go, nodejs, and finally reef-pi development environment. This guide assume OSX or Linux as the development platform.
Windows is supported for client side development only. Many reef-pi features depend on specific architecture and hardware features that are not available on Windows. Mock implementations of certain hardware drivers are provided for Windows in order to facilitate UI development."><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl crossorigin=anonymous><link rel="preload stylesheet" href=/css/main.min.css as=style><link rel=stylesheet type=text/css href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet type=text/css href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,200bold,400old"><link rel=stylesheet href=https://reef-pi.github.io/css/img.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js></script><script src=https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js></script><![endif]--><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-102968086-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><div id=content><div class="container mb-3"><nav class="navbar navbar-expand-lg"><div class=container-fluid><a class=navbar-brand href=https://reef-pi.github.io/><span class=h3>reef-pi</span></a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbar aria-controls=navbar>
<i class="fa fa-bars"></i></button><div id=navbar class="collapse navbar-collapse"><ul class="navbar-nav ms-auto mb-2 mb-lg-0"><li class=nav-item><li><a class=nav-link href=/guides/>GUIDES</a></li></li><li class=nav-item><li><a class=nav-link href=/additional-documentation/>ADDITIONAL DOCUMENTATION</a></li></li></ul></div></div></div></nav><div class=container><h3 class=mt-3><b><a href=https://reef-pi.github.io/additional-documentation/development/>Development environment</a></b></h3><div class="blog-title my-4"><h6></h6></div><div class=panel><div class=panel-body><div class=blogpost><p>reef-pi is written in <a href=https://golang.org/>go</a> and <a href=https://facebook.github.io/react/>react</a>. This guide will walk through the steps involved in setting up go, nodejs, and finally reef-pi development environment. This guide assume OSX or Linux as the development platform.</p><p>Windows is supported for client side development only. Many reef-pi features depend on specific architecture and hardware features that are not available on Windows. Mock implementations of certain hardware drivers are provided for Windows in order to facilitate UI development. Any backend features should be developed using OSX or Linux.</p><h3 id=setup-go>Setup go</h3><p>Install latest version of go. At the time of writing the guide, the latest version of go is 1.17. reef-pi should work with any version of go above 1.8.</p><p>Use any one of these three ways to install go:</p><ol><li><p>I recommend using the official <a href=https://golang.org/doc/install>go installation guide</a> to install go in your development machine.</p></li><li><p>In most cases, for linux based development environment use distribution specific package managers (dnf or apt or yum) to download
latest go. Ubuntu linux specific go installation instruction can be found <a href=https://github.com/golang/go/wiki/Ubuntu>here</a></p></li><li><p>For OSX users, if you have homebrew installed, it is as simple as</p></li></ol><pre><code>brew install go
</code></pre><p>Irrespective of how you install go, make sure you set GOPATH environment variable. I recommend setting GOPATH environment variable inside your home
directory, in a dedicated sub directory: <code>/Users/&lt;name>/gospace</code>. Declare GOPATH in your .bashrc or .bash_profile so that it persist
between sessions.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>export GOPATH<span style=color:#f92672>=</span>/Users/&lt;name&gt;/gospace
</code></pre></div><h3 id=setup-nodejs-and-yarn>Setup nodejs and yarn</h3><p>All the User Interface components in reef-pi is written using <a href=https://facebook.github.io/react/>react</a>, which requires nodejs
for development. Follow the official nodejs <a href=https://docs.npmjs.com/getting-started/installing-node>installation guide</a> to install nodejs in your development machine.
reef-pi requires nodejs version 14.0 or above.</p><p>For OSX users, if you have homebrew installed, this is as simple as</p><pre><code>brew install node
</code></pre><p>For Windows user, if you have <a href=https://chocolatey.org/>Chocolatey</a> installed, nodejs can be installed with</p><pre><code>choco install nodejs
</code></pre><p>This will install both nodejs and npm, the package manager for nodejs based libraries. reef-pi uses npm to manage nodejs libraries.</p><p>Install yarn by following the <a href=https://yarnpkg.com/getting-started/install>official instruction</a></p><h3 id=building-and-running-reef-pi-on-developer-machine>Building and running reef-pi on developer machine</h3><p>Once go and nodejs is setup, you are ready to start with reef-pi code base itself.</p><ul><li>Copy reef-pi code from github to your $GOPATH</li></ul><pre><code>git clone https://github.com/reef-pi/reef-pi.git $GOPATH/src/github.com/reef-pi/reef-pi
</code></pre><p>reef-pi project does not use any go package manager yet. A make target is used to get bare minimal dependencies from github.</p><p>All following commands & instructions assume you are working from the reef-pi repository itself, i.e.</p><pre><code>cd $GOPATH/src/github.com/reef-pi/reef-pi
</code></pre><ul><li>Download go and react dependencies</li></ul><pre><code>make install
</code></pre><p>This will install reactjs, webpack and ancillary package used by reef-pi user interface (front end) code.</p><ul><li>Build reef-pi binary and ui assets</li></ul><pre><code>make
</code></pre><ul><li>Finally, start reef-pi in dev_mode (so that all device drivers calls are ignored).</li></ul><pre><code>make start-dev
</code></pre><ul><li>You can try out the API with curl. Save the auth cookie by signing in, before making any subsequent API calls.</li></ul><pre><code>curl -X POST -c cookie.txt -d '{&quot;user&quot;:&quot;reef-pi&quot;, &quot;password&quot;:&quot;reef-pi&quot;}' http://localhost:8080/auth/signin
curl -b cookie.txt http://localhost:8080/api/drivers
</code></pre><ul><li>If you are doing UI development you can run <code>make ui-dev</code> to run webpack in development mode and regenerate assets
upon any ui file save</li></ul><pre><code>make ui-dev
</code></pre><p>Head over to your browser <a href=http://localhost:8080>http://localhost:8080/</a> to see the reef-pi in action.</p><h3 id=running-automated-tests>Running Automated Tests</h3><p>reef-pi has the following automation tools to promote code quality:</p><ul><li>Go tests</li></ul><pre><code>make test
</code></pre><ul><li>Javascript code linting</li></ul><pre><code>yarn run standard
</code></pre><ul><li>Javascript unit tests</li></ul><pre><code>yarn test
</code></pre><ul><li>To clean up everything(test databases, pre-built static assets of go binary) and start from scratch, run</li></ul><pre><code>make clean
</code></pre><ul><li>Automated smoke test: reef-pi has a comprehensive ui based end to end smoke test, that you can use to
verify your development setup. Run these make targets in separate terminals</li></ul><pre><code>make start-dev
make ui-dev
make smoke
</code></pre><h3 id=running-reef-pi-on-a-raspberry-pi>Running reef-pi on a raspberry pi</h3><p>It is likely you would want to test out a new feature on a physical raspberry pi once you have written the code for a new feature. The default make target will create development machine specific binary. For Raspberry Pi, reef-pi needs to be compiled for ARM 6 (raspberry pi zero) or ARM7 architecture. reef-pi&rsquo;s <a href=https://github.com/reef-pi/reef-pi/blob/master/Makefile>Makefile</a>
has predefined target for this. To create raspberry pi 3 or 2 specific binary, run</p><pre><code>make pi
</code></pre><p>To create pi zero specific binary, run</p><pre><code>make pi-zero
</code></pre><p>Next generate a debian package for the pi zero. This will package the javascript front end, along side systemd unit files and a stock configuration file.</p><pre><code>make deb
</code></pre><p>This debian package can be copied over to a Raspberry Pi computer and run there.</p><pre><code>scp reef-pi-x.x.x.deb pi@&lt;IP&gt;:.
</code></pre><p>To install the new package on pi zero, run</p><pre><code>sudo dpkg -i reef-pi-x.x.x.deb
</code></pre><p>This will install reef-pi binary, create the necessary directory structure, install and start reef-pi systemd service. You can check status of reef-pi service with</p><pre><code>sudo systemctl status reef-pi.service
</code></pre><p>Note, if theres an already installed reef-pi, you have to remove it first. To do so, use the following command:</p><pre><code>sudo apt-get remove -y --purge reef-pi
</code></pre></div></div></div></div></div><footer class=footer><div class=container><div class=text-muted>2016-21 &copy; Ranjib Dey, All rights reserved. Site powered by <a href=https://gohugo.io/>Hugo</a> and
<a href=http://www.github.com/nurlansu/hugo-sustain/>sustain</a> with ♥</div></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.min.js integrity=sha384-nsg8ua9HAw1y0W1btsyWgBklPnCUAFLuTMS2G72MMONqmOymq585AcH49TLBQObG crossorigin=anonymous></script></body></html>